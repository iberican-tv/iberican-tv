---
const navItems = [
  { name: "Inicio", href: "/" },
  { name: "Iberican", href: "/iberican" },
  { name: "Trabajos", href: "/trabajos" },
  { name: "Contacto", href: "/contacto" },
];

const path = Astro.url?.pathname ?? "/";
const isActive = (href) => (href === "/" ? path === "/" : path.startsWith(href));
---

<header class="fixed inset-x-0 top-0 z-50">
  <div class="bg-black/80 border-b border-white/10 backdrop-blur-md">
    <div class="max-w-7xl mx-auto px-6 h-16 flex items-center justify-between relative">

      <!-- Logo (left) -->
      <a href="/" class="flex items-center gap-3 shrink-0 z-20" aria-label="Inicio">
        <img src="/logoarriba_b.png" alt="Iberican Logo" class="w-10 h-10 object-contain" />
      </a>

      <!-- Nav (centered absolute, desktop) -->
      <nav
        class="hidden md:block absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 z-10"
        aria-label="NavegaciÃ³n principal"
      >
        <ul class="flex items-center gap-8 text-sm font-semibold text-white/90">
          {navItems.map((item) => (
            <li class="group">
              <a
                href={item.href}
                class="relative py-2"
                aria-current={isActive(item.href) ? "page" : undefined}
              >
                <span class:list={[
                  "transition-colors duration-200",
                  isActive(item.href) ? "text-white" : "text-white/85 group-hover:text-white"
                ]}>
                  {item.name}
                </span>

                <span class:list={[
                  "absolute left-0 right-0 -bottom-1 h-0.5 origin-left transition-transform duration-300 transform",
                  isActive(item.href)
                    ? "scale-x-100 bg-gradient-to-r from-red-500 to-red-700"
                    : "scale-x-0 bg-white group-hover:scale-x-100"
                ]}></span>
              </a>
            </li>
          ))}
        </ul>
      </nav>

      <!-- Actions (right) -->
      <div class="flex items-center gap-3 shrink-0 z-20">

        <!-- Modo Iberican -->
        <button
          id="neon-toggle"
          type="button"
          class="hidden sm:inline-flex items-center gap-2 px-4 h-9 rounded-full bg-white/10 hover:bg-white/15 border border-white/10 text-white/80 transition"
          aria-label="Modo Iberican"
        >
          <span aria-hidden="true">ðŸ”®</span>
          <span class="text-sm">Modo Iberican</span>
        </button>

        <!-- Vinilo (Trabajos / MÃºsica) -->
        <a
          href="/trabajos"
          class:list={[
            "p-2 rounded-full transition",
            isActive("/trabajos") ? "bg-white/10" : "hover:bg-white/10"
          ]}
          aria-label="MÃºsica"
          aria-current={isActive("/trabajos") ? "page" : undefined}
        >
          <svg class="w-5 h-5 text-white/90" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
            <circle cx="12" cy="12" r="9" stroke="currentColor" stroke-width="1.5"/>
            <circle cx="12" cy="12" r="6" stroke="currentColor" stroke-width="1.2" opacity="0.55"/>
            <circle cx="12" cy="12" r="3.5" stroke="currentColor" stroke-width="1.2" opacity="0.35"/>
            <circle cx="12" cy="12" r="2" fill="currentColor" opacity="0.9"/>
            <circle cx="12" cy="12" r="0.6" fill="black" opacity="0.6"/>
          </svg>
        </a>

        <!-- Contacto -->
        <a
          href="/contacto"
          class:list={[
            "p-2 rounded-full transition",
            isActive("/contacto") ? "bg-white/10" : "hover:bg-white/10"
          ]}
          aria-label="Contacto"
          aria-current={isActive("/contacto") ? "page" : undefined}
        >
          <svg class="w-5 h-5 text-white/90" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
            <path d="M4 6h16v12H4V6Z" stroke="currentColor" stroke-width="1.5" stroke-linejoin="round"/>
            <path d="M4 7l8 6 8-6" stroke="currentColor" stroke-width="1.5" stroke-linejoin="round"/>
          </svg>
        </a>

        <!-- Mobile toggle -->
        <button
          id="nav-toggle"
          class="md:hidden p-2 rounded-full hover:bg-white/10 transition text-white/90"
          aria-label="Abrir menÃº"
          type="button"
          aria-expanded="false"
          aria-controls="mobile-menu"
        >
          <svg class="w-6 h-6" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
            <path d="M4 7h16M4 12h16M4 17h16" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/>
          </svg>
        </button>
      </div>
    </div>
  </div>

  <!-- Mobile menu -->
  <div id="mobile-menu" class="md:hidden hidden bg-black/90 border-b border-white/10 backdrop-blur-md">
    <div class="max-w-7xl mx-auto px-6 py-4">

      <!-- Top actions mobile -->
      <div class="flex items-center gap-2 mb-4">
        <button
          id="neon-toggle-mobile"
          type="button"
          class="flex-1 inline-flex items-center justify-center gap-2 px-4 h-10 rounded-full bg-white/10 hover:bg-white/15 border border-white/10 text-white/80 transition"
        >
          <span aria-hidden="true">ðŸ”®</span>
          <span class="text-sm">Modo Iberican</span>
        </button>

        <a
          href="/trabajos"
          class:list={[
            "inline-flex items-center justify-center h-10 w-10 rounded-full border border-white/10 transition",
            isActive("/trabajos") ? "bg-white/10" : "bg-white/5 hover:bg-white/10"
          ]}
          aria-label="MÃºsica"
        >
          <svg class="w-5 h-5 text-white/90" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
            <circle cx="12" cy="12" r="9" stroke="currentColor" stroke-width="1.5"/>
            <circle cx="12" cy="12" r="6" stroke="currentColor" stroke-width="1.2" opacity="0.55"/>
            <circle cx="12" cy="12" r="3.5" stroke="currentColor" stroke-width="1.2" opacity="0.35"/>
            <circle cx="12" cy="12" r="2" fill="currentColor" opacity="0.9"/>
            <circle cx="12" cy="12" r="0.6" fill="black" opacity="0.6"/>
          </svg>
        </a>

        <a
          href="/contacto"
          class:list={[
            "inline-flex items-center justify-center h-10 w-10 rounded-full border border-white/10 transition",
            isActive("/contacto") ? "bg-white/10" : "bg-white/5 hover:bg-white/10"
          ]}
          aria-label="Contacto"
        >
          <svg class="w-5 h-5 text-white/90" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
            <path d="M4 6h16v12H4V6Z" stroke="currentColor" stroke-width="1.5" stroke-linejoin="round"/>
            <path d="M4 7l8 6 8-6" stroke="currentColor" stroke-width="1.5" stroke-linejoin="round"/>
          </svg>
        </a>
      </div>

      <ul class="flex flex-col gap-2">
        {navItems.map((item) => (
          <li>
            <a
              href={item.href}
              class:list={[
                "block px-4 py-3 rounded-lg transition",
                isActive(item.href) ? "bg-white/10 text-white" : "text-white/90 hover:bg-white/10"
              ]}
              aria-current={isActive(item.href) ? "page" : undefined}
            >
              {item.name}
            </a>
          </li>
        ))}
      </ul>
    </div>
  </div>

  <script type="module">
    const toggle = document.getElementById('nav-toggle');
    const menu = document.getElementById('mobile-menu');

    if (toggle && menu) {
      toggle.addEventListener('click', () => {
        const isHidden = menu.classList.toggle('hidden');
        toggle.setAttribute('aria-expanded', String(!isHidden));
      });
    }

    const neonDesktop = document.getElementById('neon-toggle');
    const neonMobile = document.getElementById('neon-toggle-mobile');

    function toggleNeon() {
      document.body.classList.toggle('neon');
      playSound('/audio/neon.mp3');
    }

    if (neonDesktop) neonDesktop.addEventListener('click', toggleNeon);
    if (neonMobile) neonMobile.addEventListener('click', toggleNeon);

    function playSound(src) {
      try {
        const audio = new Audio(src);
        audio.volume = 0.3;
        audio.play().catch(() => {});
      } catch (e) {}
    }
  </script>
</header>
